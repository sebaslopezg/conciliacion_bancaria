<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conciliador Bancario</title>
    <link rel="icon" type="image/x-icon" href="./assets/favicon/AR-favicon.png">
    <link rel="stylesheet" href="./assets/css/bootstrap.css">
    <link rel="stylesheet" href="./assets/css/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
</head>
<body>

<nav class="navbar bg-body-tertiary">
  <div class="container-fluid">
    <div class="col-6">
      <button id="execute" class="btn btn-primary"><i class="bi bi-file-earmark-break-fill"></i> Procesar</button>
      <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#loadJsonModal">
        <i class="bi bi-upload"></i> Cargar configuración
      </button>
      <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#generateJsonModal">
        <i class="bi bi-gear-fill"></i> Configurar
      </button>
    </div>
    <div class="col-3">
      <span>
        <label for="courrentYear">Año del extracto: </label>  <input id="courrentYear" class="form-control" type="text"> 
      </span>
    </div>

  </div>
</nav>
<br>
<div class="container">
    <div class="row align-items-center">
        <div class="col"></div>
        <div class="col-6">
            <div class="card text-bg-info">
              <div class="card-header"><i class="bi bi-window-stack"></i> Inserta aquí el excel del sistema</div>
              <div class="card-body">
                <div class="mb-3">
                    <input class="form-control excelInput" type="file" id="exSistema" accept=".xls, .xlsx">
                </div>
    
              </div>
            </div>
        </div>
    
        <div class="col"></div>
    </div>
    <br>
    <div class="row">
        <div class="col-3"></div>
    
        <div class="col-6">
            <div class="card text-bg-warning">
              <div class="card-header"><i class="bi bi-bank2"></i> Inserta aquí el excel del Banco</div>
              <div class="card-body">
                <div class="mb-3">
                    <input class="form-control excelInput" type="file" id="exBanco" accept=".xls, .xlsx">
                </div>
              </div>
            </div>
        </div>
    
        <div class="col-3"></div>
    </div>
    <br>
    <div class="row">
      <div class="col"></div>
      <div class="col-6">
        <button type="button" id="btnShowSystemTable" class="btn btn-info" disabled>Ver Solo Sistema</button>
        <button type="button" id="btnShowBankTable" class="btn btn-warning" disabled>Ver Solo Banco</button>
      </div>
      <div class="col"></div>
    </div>
    <br>
    <div id="display"></div>
</div>

<!-- Modal Load Conf -->
<div class="modal fade" id="loadJsonModal" tabindex="-1" aria-labelledby="loadJsonModalLabel">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="loadJsonModalLabel">Cargar Archivo de Configuración</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Cargue aquí el archivo de configuración "config.json"</p>
        <input class="form-control" type="file" id="jsonConfigInput" accept=" .json">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" id="btnLoadConfig" class="btn btn-primary">Cargar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Generate Conf -->
<div class="modal fade" id="generateJsonModal" tabindex="-1" data-bs-backdrop="static" aria-labelledby="generateJsonModalLabel">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="generateJsonModalLabel">Configurar</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <p>Configuración general de lectura de archivos</p>

        <div class="input-group mb-3">
            <button class="btn btn-secondary" type="button" id="btnDownLoadJsonFile">
              <i class="bi bi-download"></i> Descargar archivo de configuración
            </button>
            <input type="text" class="form-control" placeholder="Nombre del archivo" id="txtJsonFileName">
        </div>

        <div class="row mb-2">
          <button class="btn btn-info mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#systemForm">
            Configuracion para Excel del Sistema
          </button>
  
          <div class="show" id="systemForm">
            <div class="card card-body">

              <div class="row mb-3">
                <div class="col-6">
                  <label for="systemRowStart" class="form-label">Fila inicial</label>
                  <input type="text" class="form-control" id="systemRowStart" aria-describedby="systemRowStartHelp">
                  <div id="systemRowStartHelp" class="form-text">Indica desde que fila se iniciará la lectura del archivo</div>
                </div>

                <div class="col-6">
                  <label for="systemRowLimit" class="form-label">Fila limite</label>
                  <input type="text" class="form-control" id="systemRowLimit" aria-describedby="systemRowLimitHelp">
                  <div id="systemRowLimitHelp" class="form-text">Indica hasta que fila se hará la lectura del archivo</div>
                </div>
              </div>

              <div class="row mb-3">

                <div class="col-4">
                  <label for="systemDateColumn" class="form-label">Columna de la fecha</label>
                  <input type="text" class="form-control" id="systemDateColumn" aria-describedby="systemDateColumnHelp">
                  <div id="systemDateColumnHelp" class="form-text">Letra de la columna en donde se leerá la fecha de cada registro</div>
                </div>

                <div class="col-4">
                  <label for="systemDateFormat" class="form-label">Formato de fecha</label>
                  <input type="text" class="form-control" id="systemDateFormat" aria-describedby="systemDateFormatHelp">
                  <div id="systemDateFormatHelp" class="form-text">Ingrese el formato que tendra la fecha</div>
                </div>

                <div class="col-4">
                  <label for="systemDateNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="systemDateNulls" aria-describedby="systemDateNullsHelp">
                    <option value="0" selected>No</option>              
                    <option value="1">Si</option>              
                  </select>
                  <div id="systemDateNullsHelp" class="form-text">Omite las celdas que no tienen contenido y no las registra como error</div>
                </div>

              </div>

              <div class="row mb-3">

                <div class="col-6">
                  <label for="systemDescriptionColumn" class="form-label">Columna de la Descripción</label>
                  <input type="text" class="form-control" id="systemDescriptionColumn" aria-describedby="systemDescriptionColumnHelp">
                  <div id="systemDescriptionColumnHelp" class="form-text">Letra de la columna en donde se leerá la descripción de cada registro</div>
                </div>
                <div class="col-6">
                  <label for="systemDescriptionNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="systemDescriptionNulls" aria-describedby="systemDescriptionNullsHelp">
                    <option value="0" selected>No</option>              
                    <option value="1">Si</option>              
                  </select>
                  <div id="systemDescriptionNullsHelp" class="form-text">Omite las celdas que no tienen contenido y no las registra como error</div>
                </div>
              </div>

              <div class="mb-3">
                <input class="form-check-input" type="checkbox" value="" id="systemValueTAcount">
                <label class="form-check-label" for="systemValueTAcount">
                  Cuenta T
                </label>
                <div id="systemValueTAcountHelp" class="form-text">Selecciona para indicar que el archivo contiene una cuenta de tipo T (Credito/Debito)</div>
              </div>

              <div class="row mb-3">

                <div class="col-6">
                  <label for="systemValueColumn" class="form-label">Columna del Valor</label>
                  <input type="text" class="form-control" id="systemValueColumn" aria-describedby="systemValueColumnHelp">
                  <div id="systemValueColumnHelp" class="form-text">Letra de la columna en donde se leerá el valor de cada registro</div>
                </div>
                <div class="col-6">
                  <label for="systemValueNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="systemValueNulls" aria-describedby="systemValueNullsHelp">
                    <option value="0" selected>No</option>              
                    <option value="1">Si</option>              
                  </select>
                  <div id="systemValueNullsHelp" class="form-text">Omite las celdas que no tienen contenido y no las registra como error</div>
                </div>

              </div>

              <div class="row mb-3">
                <div class="col-6">
                  <label for="systemValueCreditColumn" class="form-label">Columna del Credito</label>
                  <input type="text" class="form-control" id="systemValueCreditColumn" aria-describedby="systemValueCreditColumnHelp" disabled>
                  <div id="systemValueCreditColumnHelp" class="form-text">Letra de la columna en donde se leerá el valor de cada registro en Cuenta T</div>
                </div>
                <div class="col-6">
                  <label for="systemValueCreditNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="systemValueCreditNulls" aria-describedby="systemValueCreditNullsHelp" disabled>
                    <option value="0" selected>No</option>              
                    <option value="1">Si</option>              
                  </select>
                  <div id="systemValueCreditNullsHelp" class="form-text">
                    Omite las celdas que no tienen contenido y no las registra como error
                  </div>
                </div>

              </div>

              <div class="row mb-3">

                <div class="col-6">
                  <label for="systemValueDebitColumn" class="form-label">Columna del Debito</label>
                  <input type="text" class="form-control" id="systemValueDebitColumn" aria-describedby="systemValueDebitColumnHelp" disabled>
                  <div id="systemValueDebitColumnHelp" class="form-text">
                    Letra de la columna en donde se leerá el valor de cada registro en Cuenta T
                  </div>
                </div>
                <div class="col-6">
                  <label for="systemValueDebitNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="systemValueDebitNulls" aria-describedby="systemValueDebitNullsHelp" disabled>
                    <option value="0" selected>No</option>
                    <option value="1">Si</option>
                  </select>
                  <div id="systemValueDebitNullsHelp" class="form-text">
                    Omite las celdas que no tienen contenido y no las registra como error
                  </div>
                </div>

              </div>

              <div class="mb-3">
                <input class="form-check-input" type="checkbox" value="" id="allowExtractDate">
                <label class="form-check-label" for="allowExtractDate" aria-describedby="allowExtractDateHelp">
                  Extraer fecha
                </label>
                <div id="allowExtractDateHelp" class="form-text">Extrae la fecha con la regla del formato indicada por el usuario</div>
              </div>

              <div class="row mb-3">
                <div class="col-6">
                  <label for="systemExtractDateColumn" class="form-label">Columna a extraer</label>
                  <input type="text" class="form-control" id="systemExtractDateColumn" aria-describedby="systemExtractDateColumnHelp" disabled>
                  <div id="systemExtractDateColumnHelp" class="form-text">Columna de texto donde se extraerá la fecha</div>
                </div>

                <div class="col-6">
                  <label for="systemExtractDateRegex" class="form-label">Expresión</label>
                  <input type="text" value="/al\s+(\d{1,2})\s+([a-záéíóúñ]+)\s+(\d{4})" class="form-control" id="systemExtractDateRegex" aria-describedby="systemExtractDateRegexHelp" disabled>
                  <div id="systemExtractDateRegexHelp" class="form-text">Escribe la expresión que se usará para leer la columna</div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="accordion" id="accordionSystemCustomValues">
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionSystemCustomValuesCollapse" aria-expanded="false" aria-controls="accordionSystemCustomValuesCollapse">
                        Valores personalizados
                      </button>
                    </h2>
                    <div id="accordionSystemCustomValuesCollapse" class="accordion-collapse collapse" data-bs-parent="#accordionSystemCustomValues">
                      <div class="accordion-body">
                        <div id="displaySystemCustomValues"></div>
                        <button type="button" id="btnAddSystemCustomValue" class="btn btn-secondary">Agregar valor personalizado</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- FIX -->
              <div class="row mb-3">
                <div class="accordion" id="accordionSystemConcat">
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionSystemConcatCollapse" aria-expanded="false" aria-controls="accordionSystemCustomValuesCollapse">
                        Concatenar a Columna descripcion
                      </button>
                    </h2>
                    <div id="accordionSystemConcatCollapse" class="accordion-collapse collapse" data-bs-parent="#accordionSystemConcat">
                      <div class="accordion-body">
                        <div id="displaySystemConcatValues"></div>
                        <button type="button" id="btnAddSystemConcatValue" class="btn btn-secondary">Agregar columna</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
            </div>
          </div>
        </div>

        <div class="row">
          <button class="btn btn-warning mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#bankForm">
            Configuracion para Excel del Banco
          </button>

          <div class="show" id="bankForm">
            <div class="card card-body">

              <div class="row mb-3">
                <div class="col-6">
                  <label for="bankRowStart" class="form-label">Fila inicial</label>
                  <input type="text" class="form-control" id="bankRowStart" aria-describedby="bankRowStartHelp">
                  <div id="bankRowStartHelp" class="form-text">Indica desde que fila se iniciará la lectura del archivo</div>
                </div>

                <div class="col-6">
                  <label for="bankRowLimit" class="form-label">Fila limite</label>
                  <input type="text" class="form-control" id="bankRowLimit" aria-describedby="bankRowLimitHelp">
                  <div id="bankRowLimitHelp" class="form-text">Indica hasta que fila se hará la lectura del archivo</div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-4">
                  <label for="bankDateColumn" class="form-label">Columna de la fecha</label>
                  <input type="text" class="form-control" id="bankDateColumn" aria-describedby="bankDateColumnHelp">
                  <div id="bankDateColumnHelp" class="form-text">
                    Letra de la columna en donde se leerá la fecha de cada registro
                  </div>
                </div>
                <div class="col-4">
                  <label for="bankDateFormat" class="form-label">Formato de fecha</label>
                  <input type="text" class="form-control" id="bankDateFormat" aria-describedby="bankDateFormatHelp">
                  <div id="bankDateFormatHelp" class="form-text">
                    Ingrese el formato que tendra la fecha
                  </div>
                </div>
                <div class="col-4">
                  <label for="bankDateNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="bankDateNulls" aria-describedby="bankDateNullsHelp">
                    <option value="0" selected>No</option>
                    <option value="1">Si</option>
                  </select>
                  <div id="bankDateNullsHelp" class="form-text">
                    Omite las celdas que no tienen contenido y no las registra como error
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-6">
                  <label for="bankDescriptionColumn" class="form-label">Columna de la Descripción</label>
                  <input type="text" class="form-control" id="bankDescriptionColumn" aria-describedby="bankDescriptionColumnHelp">
                  <div id="bankDescriptionColumnHelp" class="form-text">
                    Letra de la columna en donde se leerá la descripción de cada registro
                  </div>
                </div>
                <div class="col-6">
                  <label for="bankDescriptionNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="bankDescriptionNulls" aria-describedby="bankDescriptionNullsHelp">
                    <option value="0" selected>No</option>
                    <option value="1">Si</option>
                  </select>
                  <div id="bankDescriptionNullsHelp" class="form-text">
                    Omite las celdas que no tienen contenido y no las registra como error
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-6">
                  <label for="bankValueColumn" class="form-label">Columna del Valor</label>
                  <input type="text" class="form-control" id="bankValueColumn" aria-describedby="bankValueColumnHelp">
                  <div id="bankValueColumnHelp" class="form-text">
                    Letra de la columna en donde se leerá el valor de cada registro
                  </div>
                </div>
                <div class="col-6">
                  <label for="bankValueNulls" class="form-label">Omitir Celdas nulas</label>
                  <select class="form-select" id="bankValueNulls" aria-describedby="bankValueNullsHelp">
                    <option value="0" selected>No</option>
                    <option value="1">Si</option>
                  </select>
                  <div id="bankValueNullsHelp" class="form-text">
                    Omite las celdas que no tienen contenido y no las registra como error
                  </div>
                </div>
              </div>

              <div class="row mb-3">

                <div class="col-6">
                  <label for="bankRegex" class="form-label">Condicional de lectura</label>
                  <select class="form-select" id="bankRegex" aria-describedby="bankRegexHelp">
                    <option value="false" selected>No</option>              
                  </select>
                  <div id="bankRegexHelp" class="form-text">
                    Selecciona la regla que permite descartar registros que no cumplan con el formato adecuado
                  </div>
                </div>

                <div class="col-6">
                  <label for="bankSetYear" class="form-label">Concatenar Año</label>
                  <select class="form-select" id="bankSetYear" aria-describedby="bankSetYear">
                    <option value="0" selected>No</option>              
                    <option value="1">Si</option>              
                  </select>
                  <div id="bankSetYearHelp" class="form-text">Se selecciona cuando la columna de fecha no trae el año incluido</div>
                </div>
              </div>

              <!-- Buscar y reemplazar valores -->
              <div class="accordion mb-3" id="accordionReplaceValues">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Buscar y reemplazar caracteres en columna
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionReplaceValues">
                    <div class="accordion-body">
                      <div id="displayBankReplaces"></div>
                      <button type="button" id="btnAddReplaceValues" class="btn btn-secondary">Agregar Buscar y Reemplazar</button> 
                    </div>
                  </div>
                </div>
              </div>

              <div class="accordion" id="accordionReplaceBankValues">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionReplaceBankValuesCollapse" aria-expanded="false" aria-controls="accordionReplaceBankValuesCollapse">
                      Valores personalizados
                    </button>
                  </h2>
                  <div id="accordionReplaceBankValuesCollapse" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                      <div id="displayBankCustomValues"></div>
                      <button type="button" id="btnAddBankCustomValue" class="btn btn-secondary">Agregar valor personalizado</button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <hr class="border border-secondary border-1 opacity-75">

        <div class="row">
          <button class="btn btn-danger mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#dangerZone">
            Zona de peligro
          </button>
        </div>

        <div class="collapse" id="dangerZone">
          <div class="card border-danger card-body">
            <button type="button" class="btn btn-danger" onclick="deleteConfData()">
              Borrar datos de Configuración
            </button>            
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" id="btnSaveConfig" class="btn btn-primary">Guardar</button>
      </div>
    </div>
  </div>
</div>

  <script src="./assets/js/vendor/bootstrap.js"></script>
  <script src="./assets/js/vendor/sweetalert2.all.min.js"></script>
  <script src="./assets/js/vendor/excelReader.js"></script>
  <script src="./assets/js/vendor/xlsx.full.min.js"></script>
  <script src="./assets/js/config.js"></script>
  <script src="./assets/js/helpers/helpers.js"></script>
  <script src="./assets/js/errors.js"></script>
  <script src="./assets/js/dateExtractor.js"></script>
  <script src="./assets/js/getData.js"></script>
  <script src="./assets/js/setTransactions.js"></script>
  <script src="./assets/js/setConf.js"></script>
  <script src="./assets/js/app.js"></script>
</body>
</html>